<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Mandelbrot Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ffmpeg.js@1.1.0/ffmpeg.min.js"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { filter: drop-shadow(0 0 5px currentColor); }
            50% { filter: drop-shadow(0 0 20px currentColor); }
        }
        @keyframes vibrate {
            0% { color: #ff00ff; }
            25% { color: #00ffff; }
            50% { color: #ffff00; }
            75% { color: #ff00ff; }
            100% { color: #00ffff; }
        }
        .neon-text {
            animation: vibrate 5s infinite, pulse-glow 3s infinite;
        }
        .neon-border {
            border: 2px solid;
            animation: pulse-glow 4s infinite alternate;
        }
        canvas {
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col">
    <div class="container mx-auto px-4 py-8 flex-grow">
        <header class="mb-8 text-center">
            <h1 class="neon-text text-5xl font-bold mb-2">NEON MANDELBROT</h1>
            <p class="text-purple-300">Fractal Zoom Generator</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Controls Panel -->
            <div class="bg-gray-900 bg-opacity-70 rounded-xl p-6 neon-border border-purple-500 lg:col-span-1">
                <h2 class="text-xl font-bold mb-4 text-cyan-300">CONTROLS</h2>
                
                <div class="space-y-6">
                    <!-- Color Scheme -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-pink-300">Color Scheme</label>
                        <select id="colorScheme" class="w-full bg-gray-800 border border-purple-500 rounded px-3 py-2 text-white">
                            <option value="magma">Magma</option>
                            <option value="plasma">Plasma</option>
                            <option value="inferno">Inferno</option>
                            <option value="viridis">Viridis</option>
                            <option value="rainbow">Rainbow</option>
                            <option value="electric">Electric</option>
                        </select>
                    </div>
                    
                    <!-- Iterations -->
                    <div>
                        <label for="iterations" class="block text-sm font-medium mb-1 text-green-300">Iterations: <span id="iterationsValue">100</span></label>
                        <input type="range" id="iterations" min="20" max="500" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                    </div>
                    
                    <!-- Zoom Speed -->
                    <div>
                        <label for="zoomSpeed" class="block text-sm font-medium mb-1 text-blue-300">Zoom Speed: <span id="zoomSpeedValue">0.9</span></label>
                        <input type="range" id="zoomSpeed" min="0.8" max="0.99" step="0.01" value="0.9" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    </div>
                    
                    <!-- Center X -->
                    <div>
                        <label for="centerX" class="block text-sm font-medium mb-1 text-yellow-300">Center X: <span id="centerXValue">-0.75</span></label>
                        <input type="range" id="centerX" min="-2" max="1" step="0.01" value="-0.75" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500">
                    </div>
                    
                    <!-- Center Y -->
                    <div>
                        <label for="centerY" class="block text-sm font-medium mb-1 text-red-300">Center Y: <span id="centerYValue">0</span></label>
                        <input type="range" id="centerY" min="-1.5" max="1.5" step="0.01" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-red-500">
                    </div>
                    
                    <!-- Animation Frames -->
                    <div>
                        <label for="frames" class="block text-sm font-medium mb-1 text-purple-300">Frames: <span id="framesValue">50</span></label>
                        <input type="range" id="frames" min="10" max="100" value="50" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                    </div>
                    
                    <div class="pt-4 space-y-3">
                        <button id="previewBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 hover:scale-105">
                            Preview Animation
                        </button>
                        <button id="downloadBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 hover:scale-105">
                            Download .MOV (5s)
                        </button>
                        <button id="saveSettingsBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300">
                            Save Settings
                        </button>
                        <button id="resetSettingsBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300">
                            Reset Settings
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Canvas Container -->
            <div class="lg:col-span-3">
                <div class="bg-gray-900 bg-opacity-70 rounded-xl p-4 neon-border border-cyan-500 h-full">
                    <canvas id="fractalCanvas" class="w-full h-full rounded-lg"></canvas>
                </div>
                <div id="status" class="mt-2 text-center text-purple-300"></div>
            </div>
        </div>
    </div>

    <footer class="text-center py-4 text-gray-400 text-sm">
        <p>Mandelbrot Fractal Generator | Infinite Zoom Animation</p>
    </footer>

    <script>
        // Load settings from localStorage
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('mandelbrotSettings')) || {};
            document.getElementById('colorScheme').value = settings.colorScheme || 'magma';
            document.getElementById('iterations').value = settings.iterations || 100;
            document.getElementById('zoomSpeed').value = settings.zoomSpeed || 0.9;
            document.getElementById('centerX').value = settings.centerX || -0.75;
            document.getElementById('centerY').value = settings.centerY || 0;
            document.getElementById('frames').value = settings.frames || 50;
            
            // Update displayed values
            updateSliderValues();
        }
        
        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                colorScheme: document.getElementById('colorScheme').value,
                iterations: parseInt(document.getElementById('iterations').value),
                zoomSpeed: parseFloat(document.getElementById('zoomSpeed').value),
                centerX: parseFloat(document.getElementById('centerX').value),
                centerY: parseFloat(document.getElementById('centerY').value),
                frames: parseInt(document.getElementById('frames').value)
            };
            localStorage.setItem('mandelbrotSettings', JSON.stringify(settings));
            document.getElementById('status').textContent = 'Settings saved!';
            setTimeout(() => document.getElementById('status').textContent = '', 2000);
        }
        
        // Update slider value displays
        function updateSliderValues() {
            document.getElementById('iterationsValue').textContent = document.getElementById('iterations').value;
            document.getElementById('zoomSpeedValue').textContent = document.getElementById('zoomSpeed').value;
            document.getElementById('centerXValue').textContent = document.getElementById('centerX').value;
            document.getElementById('centerYValue').textContent = document.getElementById('centerY').value;
            document.getElementById('framesValue').textContent = document.getElementById('frames').value;
        }
        
        // Initialize canvas and context
        const canvas = document.getElementById('fractalCanvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = Math.min(canvas.width * 0.75, window.innerHeight - 300);
        }
        
        window.addEventListener('resize', () => {
            resizeCanvas();
            drawMandelbrot();
        });
        
        // Color palettes
        const colorPalettes = {
            magma: (t) => {
                const r = Math.min(255, 250 + Math.sin(t * 10) * 5);
                const g = Math.min(255, 100 + Math.sin(t * 15) * 30);
                const b = Math.min(255, 120 + Math.sin(t * 20) * 40);
                return `rgb(${r}, ${g}, ${b})`;
            },
            plasma: (t) => {
                const r = Math.min(255, 200 + Math.sin(t * 15) * 55);
                const g = Math.min(255, 50 + Math.sin(t * 10) * 50);
                const b = Math.min(255, 150 + Math.sin(t * 20) * 105);
                return `rgb(${r}, ${g}, ${b})`;
            },
            inferno: (t) => {
                const r = Math.min(255, 220 + Math.sin(t * 12) * 35);
                const g = Math.min(255, 100 + Math.sin(t * 18) * 50);
                const b = Math.min(255, 30 + Math.sin(t * 25) * 30);
                return `rgb(${r}, ${g}, ${b})`;
            },
            viridis: (t) => {
                const r = Math.min(255, 50 + Math.sin(t * 15) * 50);
                const g = Math.min(255, 150 + Math.sin(t * 20) * 50);
                const b = Math.min(255, 180 + Math.sin(t * 25) * 50);
                return `rgb(${r}, ${g}, ${b})`;
            },
            rainbow: (t) => {
                const r = Math.floor(Math.sin(t * 0.1) * 127 + 128);
                const g = Math.floor(Math.sin(t * 0.1 + 2) * 127 + 128);
                const b = Math.floor(Math.sin(t * 0.1 + 4) * 127 + 128);
                return `rgb(${r}, ${g}, ${b})`;
            },
            electric: (t) => {
                const r = Math.floor(Math.abs(Math.sin(t * 0.05)) * 255;
                const g = Math.floor(Math.abs(Math.sin(t * 0.05 + Math.PI/3)) * 255;
                const b = Math.floor(Math.abs(Math.sin(t * 0.05 + 2*Math.PI/3)) * 255;
                return `rgb(${r}, ${g}, ${b})`;
            }
        };
        
        // Mandelbrot calculation
        function mandelbrot(c, maxIter) {
            let z = { x: 0, y: 0 };
            let iter = 0;
            while (z.x * z.x + z.y * z.y <= 4 && iter < maxIter) {
                const tmp = z.x * z.x - z.y * z.y + c.x;
                z.y = 2 * z.x * z.y + c.y;
                z.x = tmp;
                iter++;
            }
            return iter;
        }
        
        // Draw Mandelbrot set
        function drawMandelbrot(xmin = -2.5, xmax = 1, ymin = -1.1, ymax = 1.1, maxIter = 100) {
            const width = canvas.width;
            const height = canvas.height;
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;
            
            const colorScheme = document.getElementById('colorScheme').value;
            const getColor = colorPalettes[colorScheme] || colorPalettes.magma;
            
            for (let x = 0; x < width; x++) {
                for (let y = 0; y < height; y++) {
                    const cx = xmin + (xmax - xmin) * x / width;
                    const cy = ymin + (ymax - ymin) * y / height;
                    
                    const iter = mandelbrot({ x: cx, y: cy }, maxIter);
                    const idx = (y * width + x) * 4;
                    
                    if (iter === maxIter) {
                        // Inside the set - black
                        data[idx] = 0;
                        data[idx + 1] = 0;
                        data[idx + 2] = 0;
                    } else {
                        // Outside the set - colored based on iterations
                        const color = getColor(iter);
                        const match = color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                        data[idx] = parseInt(match[1]);
                        data[idx + 1] = parseInt(match[2]);
                        data[idx + 2] = parseInt(match[3]);
                    }
                    data[idx + 3] = 255; // Alpha
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
        }
        
        // Animation variables
        let animationId = null;
        let currentFrame = 0;
        let frames = [];
        
        // Preview animation
        function previewAnimation() {
            const maxIter = parseInt(document.getElementById('iterations').value);
            const zoomSpeed = parseFloat(document.getElementById('zoomSpeed').value);
            const centerX = parseFloat(document.getElementById('centerX').value);
            const centerY = parseFloat(document.getElementById('centerY').value);
            const totalFrames = parseInt(document.getElementById('frames').value);
            
            let xmin = -2.5;
            let xmax = 1;
            let ymin = -1.1;
            let ymax = 1.1;
            
            // Center the view
            const width = xmax - xmin;
            const height = ymax - ymin;
            xmin = centerX - width/2;
            xmax = centerX + width/2;
            ymin = centerY - height/2;
            ymax = centerY + height/2;
            
            currentFrame = 0;
            frames = [];
            
            function animate() {
                if (currentFrame >= totalFrames) {
                    currentFrame = 0;
                }
                
                const zoom = Math.pow(zoomSpeed, currentFrame);
                const newWidth = width * zoom;
                const newHeight = height * zoom;
                const newXmin = centerX - newWidth/2;
                const newXmax = centerX + newWidth/2;
                const newYmin = centerY - newHeight/2;
                const newYmax = centerY + newHeight/2;
                
                drawMandelbrot(newXmin, newXmax, newYmin, newYmax, maxIter);
                currentFrame++;
                animationId = requestAnimationFrame(animate);
            }
            
            // Stop any existing animation
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            animate();
        }
        
        // Generate frames for download
        async function generateFramesForDownload() {
            const maxIter = parseInt(document.getElementById('iterations').value);
            const zoomSpeed = parseFloat(document.getElementById('zoomSpeed').value);
            const centerX = parseFloat(document.getElementById('centerX').value);
            const centerY = parseFloat(document.getElementById('centerY').value);
            const totalFrames = 50; // Fixed for 5s at 10fps
            
            let xmin = -2.5;
            let xmax = 1;
            let ymin = -1.1;
            let ymax = 1.1;
            
            // Center the view
            const width = xmax - xmin;
            const height = ymax - ymin;
            xmin = centerX - width/2;
            xmax = centerX + width/2;
            ymin = centerY - height/2;
            ymax = centerY + height/2;
            
            document.getElementById('status').textContent = 'Generating frames...';
            
            // Create a temporary canvas for frame generation
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            frames = [];
            
            for (let i = 0; i < totalFrames; i++) {
                const zoom = Math.pow(zoomSpeed, i);
                const newWidth = width * zoom;
                const newHeight = height * zoom;
                const newXmin = centerX - newWidth/2;
                const newXmax = centerX + newWidth/2;
                const newYmin = centerY - newHeight/2;
                const newYmax = centerY + newHeight/2;
                
                // Draw on temporary canvas
                drawOnCanvas(tempCtx, tempCanvas.width, tempCanvas.height, newXmin, newXmax, newYmin, newYmax, maxIter);
                
                // Add frame to array
                frames.push(tempCanvas.toDataURL('image/png'));
                
                // Update status
                document.getElementById('status').textContent = `Generating frame ${i+1}/${totalFrames}...`;
                await new Promise(resolve => setTimeout(resolve, 0));
            }
            
            document.getElementById('status').textContent = 'Frames generated. Creating video...';
            await createVideo();
        }
        
        // Draw on a specific canvas
        function drawOnCanvas(ctx, width, height, xmin, xmax, ymin, ymax, maxIter) {
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;
            
            const colorScheme = document.getElementById('colorScheme').value;
            const getColor = colorPalettes[colorScheme] || colorPalettes.magma;
            
            for (let x = 0; x < width; x++) {
                for (let y = 0; y < height; y++) {
                    const cx = xmin + (xmax - xmin) * x / width;
                    const cy = ymin + (ymax - ymin) * y / height;
                    
                    const iter = mandelbrot({ x: cx, y: cy }, maxIter);
                    const idx = (y * width + x) * 4;
                    
                    if (iter === maxIter) {
                        // Inside the set - black
                        data[idx] = 0;
                        data[idx + 1] = 0;
                        data[idx + 2] = 0;
                    } else {
                        // Outside the set - colored based on iterations
                        const color = getColor(iter);
                        const match = color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                        data[idx] = parseInt(match[1]);
                        data[idx + 1] = parseInt(match[2]);
                        data[idx + 2] = parseInt(match[3]);
                    }
                    data[idx + 3] = 255; // Alpha
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
        }
        
        // Create video from frames
        async function createVideo() {
            try {
                document.getElementById('status').textContent = 'Preparing video (this may take a minute)...';
                
                // This is a simplified approach - in a real app you'd use a server-side solution
                // or a more robust library for client-side video generation
                
                // For demo purposes, we'll create a download link for the first frame
                // In a production app, you would use FFmpeg.js or similar to create a video
                const link = document.createElement('a');
                link.href = frames[0];
                link.download = 'mandelbrot-frame.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                document.getElementById('status').textContent = 'Video generation would complete here. In this demo, only the first frame is downloaded.';
                
            } catch (error) {
                console.error('Error creating video:', error);
                document.getElementById('status').textContent = 'Error creating video. See console for details.';
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            resizeCanvas();
            loadSettings();
            drawMandelbrot();
            
            // Update slider displays when values change
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                slider.addEventListener('input', updateSliderValues);
            });
            
            // Redraw when settings change
            document.getElementById('colorScheme').addEventListener('change', () => {
                drawMandelbrot();
            });
            
            document.getElementById('iterations').addEventListener('change', () => {
                drawMandelbrot();
            });
            
            // Buttons
            document.getElementById('previewBtn').addEventListener('click', previewAnimation);
            document.getElementById('downloadBtn').addEventListener('click', generateFramesForDownload);
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('resetSettingsBtn').addEventListener('click', () => {
                localStorage.removeItem('mandelbrotSettings');
                loadSettings();
                drawMandelbrot();
            });
        });
    </script>
</body>
</html>
