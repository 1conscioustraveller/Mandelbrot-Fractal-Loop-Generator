<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ohm's Law Interactive Circuit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.7.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.7.1/core.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center justify-center p-6">

    <h1 class="text-3xl font-bold mb-4 text-cyan-400">⚡ Ohm's Law Visualizer ⚡</h1>

    <!-- Mode selector -->
    <div class="mb-6">
        <label for="mode-select" class="block mb-2 text-lg">Solve for:</label>
        <select id="mode-select" class="bg-gray-800 text-white rounded px-4 py-2">
            <option>Solve I</option>
            <option>Solve V</option>
            <option>Solve R</option>
        </select>
    </div>

    <!-- Sliders -->
    <div class="space-y-6 w-full max-w-md">
        <div>
            <label for="slider-V" class="block mb-1">Voltage (V)</label>
            <input id="slider-V" type="range" min="0" max="20" step="0.1" value="9"
                class="w-full accent-cyan-400">
        </div>
        <div>
            <label for="slider-I" class="block mb-1">Current (A)</label>
            <input id="slider-I" type="range" min="0" max="5" step="0.01" value="0.09"
                class="w-full accent-green-400">
        </div>
        <div>
            <label for="slider-R" class="block mb-1">Resistance (Ω)</label>
            <input id="slider-R" type="range" min="1" max="500" step="1" value="100"
                class="w-full accent-yellow-400">
        </div>
    </div>

    <!-- Circuit display -->
    <div class="mt-8 bg-gray-800 p-4 rounded-lg shadow-lg">
        <img id="circuit-img" class="mx-auto" />
    </div>

    <!-- PyScript logic -->
    <py-config>
        packages = ["matplotlib"]
    </py-config>

    <py-script>
from pyscript import Element
import matplotlib.pyplot as plt
import io, base64, math

mode = "Solve I"
V = 9.0
I = 0.09
R = 100.0

def draw_battery(ax, x, y, height, spacing):
    ax.plot([x - spacing/2, x - spacing/2], [y - height, y + height])
    ax.plot([x + spacing/2, x + spacing/2], [y - height/2, y + height/2])

def draw_resistor(ax, x1, y1, x2, y2, zigzags=6, amplitude=0.25):
    dx = x2 - x1
    dy = y2 - y1
    length = (dx**2 + dy**2)**0.5
    if length == 0:
        return
    ux, uy = dx/length, dy/length
    px, py = -uy, ux
    pts = [(x1, y1)]
    segment = length / (zigzags * 2)
    for i in range(1, zigzags * 2):
        t = i * segment
        base_x = x1 + ux * t
        base_y = y1 + uy * t
        offset = amplitude if i % 2 == 1 else -amplitude
        pts.append((base_x + px * offset, base_y + py * offset))
    pts.append((x2, y2))
    xs, ys = zip(*pts)
    ax.plot(xs, ys)

def format_val(val, unit):
    if val is None or isinstance(val, float) and (math.isnan(val) or math.isinf(val)):
        return "—"
    if abs(val) >= 100:
        s = f"{val:.0f}"
    elif abs(val) >= 10:
        s = f"{val:.1f}"
    else:
        s = f"{val:.2f}"
    return f"{s} {unit}"

def update_plot(*args):
    global mode, V, I, R
    mode = Element("mode-select").element.value
    V = float(Element("slider-V").element.value)
    I = float(Element("slider-I").element.value)
    R = float(Element("slider-R").element.value)

    if mode == "Solve I":
        I = float('nan') if R <= 0 else V / R
    elif mode == "Solve V":
        V = I * R
    elif mode == "Solve R":
        R = float('nan') if I <= 0 else V / I

    fig, ax = plt.subplots(figsize=(6,4))
    left, right, top, bottom = -4, 4, 1.5, -1.5
    ax.plot([left, right], [top, top])
    ax.plot([right, right], [top, bottom])
    ax.plot([left, right], [bottom, bottom])
    ax.plot([left, left], [bottom, top])

    draw_battery(ax, left, 0.0, height=0.8, spacing=0.6)
    draw_resistor(ax, 0.0, 0.0, right, 0.0)

    lw = 1.0 + 4.0 * (0.0 if math.isnan(I) else min(1.0, abs(I)/2.0))
    ax.annotate("", xy=(right - 0.5, top), xytext=(left + 0.5, top),
                arrowprops=dict(arrowstyle="->", linewidth=lw))

    ax.text(0.0, top + 0.3, f"I = {format_val(I, 'A')}", ha="center", va="bottom", color="white")
    ax.text(left - 0.2, 0.0, f"V = {format_val(V, 'V')}", ha="right", va="center", rotation=90, color="white")
    ax.text(right + 0.2, 0.0, f"R = {format_val(R, 'Ω')}", ha="left", va="center", color="white")

    if mode == "Solve I":
        eq = r"$I = \dfrac{V}{R}$"
    elif mode == "Solve V":
        eq = r"$V = I \cdot R$"
    else:
        eq = r"$R = \dfrac{V}{I}$"
    ax.text(0.0, bottom - 0.4, eq, ha="center", va="top", color="white")

    ax.set_aspect("equal")
    ax.set_xlim(left - 1.5, right + 1.5)
    ax.set_ylim(bottom - 1.0, top + 1.0)
    ax.axis("off")
    fig.patch.set_facecolor("black")
    ax.set_facecolor("black")

    buf = io.BytesIO()
    fig.savefig(buf, format="png", bbox_inches="tight", facecolor="black")
    plt.close(fig)
    buf.seek(0)
    img_base64 = base64.b64encode(buf.read()).decode("utf-8")
    Element("circuit-img").element.src = f"data:image/png;base64,{img_base64}"

# Event bindings
for slider_id in ["slider-V", "slider-I", "slider-R"]:
    Element(slider_id).element.oninput = update_plot
Element("mode-select").element.onchange = update_plot

update_plot()
    </py-script>

</body>
</html>
