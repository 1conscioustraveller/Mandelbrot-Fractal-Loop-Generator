<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ohm's Law Interactive Circuit</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- PyScript -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.7.1/core.css">
    <script defer src="https://pyscript.net/releases/2024.7.1/core.js"></script>

    <style>
        body {
            background: radial-gradient(circle at top, #0f172a, #020617);
            color: white;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type=range] {
            accent-color: #22d3ee; /* Tailwind cyan-400 */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="glass rounded-2xl shadow-2xl max-w-6xl w-full p-8 space-y-6">
        <h1 class="text-center text-4xl font-bold tracking-wide text-cyan-400">
            ⚡ Ohm's Law Interactive Circuit
        </h1>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Circuit Display -->
            <div class="bg-white rounded-xl p-4 shadow-lg w-full lg:w-2/3">
                <py-config>
                    packages = ["matplotlib"]
                </py-config>

                <py-script output="circuit-plot">
from pyscript import Element
import math
import matplotlib.pyplot as plt

# Global state
mode = "Solve I"
V = 9.0
I = 0.09
R = 100.0

def draw_battery(ax, x, y, height, spacing):
    ax.plot([x - spacing/2, x - spacing/2], [y - height, y + height])
    ax.plot([x + spacing/2, x + spacing/2], [y - height/2, y + height/2])

def draw_resistor(ax, x1, y1, x2, y2, zigzags=6, amplitude=0.25):
    dx = x2 - x1
    dy = y2 - y1
    length = (dx**2 + dy**2)**0.5
    if length == 0:
        return
    ux, uy = dx/length, dy/length
    px, py = -uy, ux
    pts = [(x1, y1)]
    segment = length / (zigzags * 2)
    for i in range(1, zigzags * 2):
        t = i * segment
        base_x = x1 + ux * t
        base_y = y1 + uy * t
        offset = amplitude if i % 2 == 1 else -amplitude
        pts.append((base_x + px * offset, base_y + py * offset))
    pts.append((x2, y2))
    xs, ys = zip(*pts)
    ax.plot(xs, ys)

def format_val(val, unit):
    if val is None or isinstance(val, float) and (math.isnan(val) or math.isinf(val)):
        return "—"
    if abs(val) >= 100:
        s = f"{val:.0f}"
    elif abs(val) >= 10:
        s = f"{val:.1f}"
    else:
        s = f"{val:.2f}"
    return f"{s} {unit}"

def update_plot(*args):
    global mode, V, I, R
    # Get values from sliders/select
    mode = Element("mode-select").element.value
    V = float(Element("slider-V").element.value)
    I = float(Element("slider-I").element.value)
    R = float(Element("slider-R").element.value)

    # Compute missing variable
    if mode == "Solve I":
        I = float('nan') if R <= 0 else V / R
    elif mode == "Solve V":
        V = I * R
    elif mode == "Solve R":
        R = float('nan') if I <= 0 else V / I

    # Draw
    fig, ax = plt.subplots(figsize=(6,4))
    left, right, top, bottom = -4, 4, 1.5, -1.5
    ax.plot([left, right], [top, top])
    ax.plot([right, right], [top, bottom])
    ax.plot([left, right], [bottom, bottom])
    ax.plot([left, left], [bottom, top])

    draw_battery(ax, left, 0.0, height=0.8, spacing=0.6)
    draw_resistor(ax, 0.0, 0.0, right, 0.0)

    lw = 1.0 + 4.0 * (0.0 if math.isnan(I) else min(1.0, abs(I)/2.0))
    ax.annotate("", xy=(right - 0.5, top), xytext=(left + 0.5, top),
                arrowprops=dict(arrowstyle="->", linewidth=lw))

    ax.text(0.0, top + 0.3, f"I = {format_val(I, 'A')}", ha="center", va="bottom")
    ax.text(left - 0.2, 0.0, f"V = {format_val(V, 'V')}", ha="right", va="center", rotation=90)
    ax.text(right + 0.2, 0.0, f"R = {format_val(R, 'Ω')}", ha="left", va="center")

    if mode == "Solve I":
        eq = r"$I = \dfrac{V}{R}$"
    elif mode == "Solve V":
        eq = r"$V = I \cdot R$"
    else:
        eq = r"$R = \dfrac{V}{I}$"
    ax.text(0.0, bottom - 0.4, eq, ha="center", va="top")

    ax.set_aspect("equal")
    ax.set_xlim(left - 1.5, right + 1.5)
    ax.set_ylim(bottom - 1.0, top + 1.0)
    ax.axis("off")

    Element("circuit-plot").clear()
    fig.savefig(Element("circuit-plot").element, format="png")

# Initial draw
update_plot()
                </py-script>

                <!-- Circuit image -->
                <div id="circuit-plot" class="flex justify-center"></div>
            </div>

            <!-- Controls -->
            <div class="w-full lg:w-1/3 space-y-4">
                <div class="glass p-4 rounded-lg">
                    <label class="block mb-2 font-semibold text-cyan-300">Mode</label>
                    <select id="mode-select" class="w-full p-2 rounded bg-gray-900 text-white"
                            onchange="pyscript.runtime.globals.update_plot()">
                        <option>Solve I</option>
                        <option>Solve V</option>
                        <option>Solve R</option>
                    </select>
                </div>

                <div class="glass p-4 rounded-lg">
                    <label for="slider-V" class="block mb-2 font-semibold text-cyan-300">Voltage V (V)</label>
                    <input id="slider-V" type="range" min="0" max="24" step="0.1" value="9"
                           class="w-full"
                           oninput="pyscript.runtime.globals.update_plot()">
                </div>

                <div class="glass p-4 rounded-lg">
                    <label for="slider-I" class="block mb-2 font-semibold text-cyan-300">Current I (A)</label>
                    <input id="slider-I" type="range" min="0" max="2" step="0.01" value="0.09"
                           class="w-full"
                           oninput="pyscript.runtime.globals.update_plot()">
                </div>

                <div class="glass p-4 rounded-lg">
                    <label for="slider-R" class="block mb-2 font-semibold text-cyan-300">Resistance R (Ω)</label>
                    <input id="slider-R" type="range" min="1" max="1000" step="1" value="100"
                           class="w-full"
                           oninput="pyscript.runtime.globals.update_plot()">
                </div>
            </div>
        </div>
    </div>

</body>
</html>
